var $special,resizeTimeout,$event=$.event;$special=$event.special.debouncedresize={setup:function(){$(this).on("resize",$special.handler)},teardown:function(){$(this).off("resize",$special.handler)},handler:function(i,e){var t=this,s=arguments,n=function(){i.type="debouncedresize",$event.dispatch.apply(t,s)};resizeTimeout&&clearTimeout(resizeTimeout),e?n():resizeTimeout=setTimeout(n,$special.threshold)},threshold:250};var BLANK="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";$.fn.imagesLoaded=function(t){var s=this,n=$.isFunction($.Deferred)?$.Deferred():0,a=$.isFunction(n.notify),h=s.find("img").add(s.filter("img")),r=[],o=[],d=[];function c(){var i=$(o),e=$(d);n&&(d.length?n.reject(h,i,e):n.resolve(h)),$.isFunction(t)&&t.call(s,h,i,e)}function l(i,e){i.src!==BLANK&&-1===$.inArray(i,r)&&(r.push(i),e?d.push(i):o.push(i),$.data(i,"imagesLoaded",{isBroken:e,src:i.src}),a&&n.notifyWith($(i),[e,h,$(o),$(d)]),h.length===r.length&&(setTimeout(c),h.unbind(".imagesLoaded")))}return $.isPlainObject(t)&&$.each(t,function(i,e){"callback"===i?t=e:n&&n[i](e)}),h.length?h.bind("load.imagesLoaded error.imagesLoaded",function(i){l(i.target,"error"===i.type)}).each(function(i,e){var t=e.src,s=$.data(e,"imagesLoaded");s&&s.src===t?l(e,s.isBroken):e.complete&&void 0!==e.naturalWidth?l(e,0===e.naturalWidth||0===e.naturalHeight):(e.readyState||e.complete)&&(e.src=BLANK,e.src=t)}):c(),n?n.promise(s):s};var Grid=function(){var s,e=$("#og-grid"),n=e.children("li"),a=-1,h=-1,r=0,t=$(window),o=$("html, body"),d={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"}[Modernizr.prefixed("transition")],c=Modernizr.csstransitions,l={minHeight:500,speed:350,easing:"ease"};function g(e){n.each(function(){var i=$(this);i.data("offsetTop",i.offset().top),e&&i.data("height",i.height())})}function p(i){i.on("click","span.og-close",function(){return u(),!1}).children("a").on("click",function(i){var e=$(this).parent();return a===e.index()?u():function(i){var e=$.data(this,"preview"),t=i.data("offsetTop");if(void(r=0)!==e){if(h===t)return e.update(i);h<t&&(r=e.height),u()}h=t,(e=$.data(this,"preview",new m(i))).open()}(e),!1})}function f(){s={width:t.width(),height:t.height()}}function u(){a=-1,$.data(this,"preview").close(),$.removeData(this,"preview")}function m(i){this.$item=i,this.expandedIdx=this.$item.index(),this.create(),this.update()}return m.prototype={create:function(){this.$title=$("<h3></h3>"),this.$description=$("<p></p>"),this.$href=$('<a href="#">Read More</a>'),this.$details=$('<div class="og-details"></div>').append(this.$title,this.$description,this.$href),this.$loading=$('<div class="og-loading"></div>'),this.$fullimage=$('<div class="og-fullimg"></div>').append(this.$loading),this.$closePreview=$('<span class="og-close"></span>'),this.$previewInner=$('<div class="og-expander-inner"></div>').append(this.$closePreview,this.$fullimage,this.$details),this.$previewEl=$('<div class="og-expander"></div>').append(this.$previewInner),this.$item.append(this.getEl()),c&&this.setTransition()},update:function(i){(i&&(this.$item=i),-1!==a)&&(n.eq(a).removeClass("og-expanded"),this.$item.addClass("og-expanded"),this.positionPreview());a=this.$item.index();var e=this.$item.children("a"),t={href:e.attr("href"),largesrc:e.data("largesrc"),title:e.data("title"),description:e.data("description")};this.$title.html(t.title),this.$description.html(t.description),this.$href.attr("href",t.href);var s=this;void 0!==s.$largeImg&&s.$largeImg.remove(),s.$fullimage.is(":visible")&&(this.$loading.show(),$("<img/>").load(function(){var i=$(this);i.attr("src")===s.$item.children("a").data("largesrc")&&(s.$loading.hide(),s.$fullimage.find("img").remove(),s.$largeImg=i.fadeIn(350),s.$fullimage.append(s.$largeImg))}).attr("src",t.largesrc))},open:function(){setTimeout($.proxy(function(){this.setHeights(),this.positionPreview()},this),25)},close:function(){var i=this,e=function(){c&&$(this).off(d),i.$item.removeClass("og-expanded"),i.$previewEl.remove()};return setTimeout($.proxy(function(){void 0!==this.$largeImg&&this.$largeImg.fadeOut("fast"),this.$previewEl.css("height",0);var i=n.eq(this.expandedIdx);i.css("height",i.data("height")).on(d,e),c||e.call()},this),25),!1},calcHeight:function(){var i=s.height-this.$item.data("height")-10,e=s.height;i<l.minHeight&&(i=l.minHeight,e=l.minHeight+this.$item.data("height")+10),this.height=i,this.itemHeight=e},setHeights:function(){var i=this,e=function(){c&&i.$item.off(d),i.$item.addClass("og-expanded")};this.calcHeight(),this.$previewEl.css("height",this.height),this.$item.css("height",this.itemHeight).on(d,e),c||e.call()},positionPreview:function(){var i=this.$item.data("offsetTop"),e=this.$previewEl.offset().top-r,t=this.height+this.$item.data("height")+10<=s.height?i:this.height<s.height?e-(s.height-this.height):e;o.animate({scrollTop:t},l.speed)},setTransition:function(){this.$previewEl.css("transition","height "+l.speed+"ms "+l.easing),this.$item.css("transition","height "+l.speed+"ms "+l.easing)},getEl:function(){return this.$previewEl}},{init:function(i){l=$.extend(!0,{},l,i),e.imagesLoaded(function(){g(!0),f(),p(n),t.on("debouncedresize",function(){r=0,h=-1,g(),f();var i=$.data(this,"preview");void 0!==i&&u()})})},addItems:function(i){n=n.add(i),i.each(function(){var i=$(this);i.data({offsetTop:i.offset().top,height:i.height()})}),p(i)}}}();